{"ast":null,"code":"import _regeneratorRuntime from \"@babel/runtime/regenerator\";\nimport _asyncToGenerator from \"@babel/runtime/helpers/esm/asyncToGenerator\";\nimport _classCallCheck from \"@babel/runtime/helpers/esm/classCallCheck\";\nimport _defineProperty from \"@babel/runtime/helpers/esm/defineProperty\";\n\nfunction ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); if (enumerableOnly) symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; }); keys.push.apply(keys, symbols); } return keys; }\n\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; if (i % 2) { ownKeys(Object(source), true).forEach(function (key) { _defineProperty(target, key, source[key]); }); } else if (Object.getOwnPropertyDescriptors) { Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)); } else { ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } } return target; }\n\n// Firebase services\nimport \"firebase/firestore\";\nimport \"firebase/auth\";\nvar isServer = false;\nvar isProd = false;\nvar config = {\n  apiKey: \"AIzaSyBBjKdrfUqYxzv8AuFezBLttmiUj6evhz0\",\n  authDomain: \"testing-2b05e.firebaseapp.com\",\n  databaseURL: \"https://testing-2b05e.firebaseio.com\",\n  projectId: \"testing-2b05e\",\n  storageBucket: \"testing-2b05e.appspot.com\",\n  messagingSenderId: \"671346717916\",\n  appId: \"1:671346717916:web:273e09a3717613e7c3b019\"\n};\nvar auth = null;\nvar firestore = null;\nvar analytics = null;\n\nvar Firebase = function Firebase() {\n  var _this = this;\n\n  _classCallCheck(this, Firebase);\n\n  _defineProperty(this, \"isAuthUser\", function () {\n    return _this.auth.currentUser !== null;\n  });\n\n  _defineProperty(this, \"authUser\", function () {\n    return _this.auth.currentUser;\n  });\n\n  _defineProperty(this, \"getRef\", function (_ref) {\n    var collection = _ref.collection,\n        doc = _ref.doc;\n    return _this.db.collection(collection).doc(doc);\n  });\n\n  _defineProperty(this, \"authRef\", function () {\n    var authUser = _this.authUser();\n\n    if (!authUser) {\n      return null;\n    }\n\n    return _this.getRef({\n      collection: \"users\",\n      doc: authUser.uid\n    });\n  });\n\n  _defineProperty(this, \"query\", function () {\n    var _ref2 = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {},\n        collection = _ref2.collection,\n        _ref2$orderBy = _ref2.orderBy,\n        orderBy = _ref2$orderBy === void 0 ? null : _ref2$orderBy,\n        _ref2$startAt = _ref2.startAt,\n        startAt = _ref2$startAt === void 0 ? null : _ref2$startAt,\n        _ref2$limit = _ref2.limit,\n        limit = _ref2$limit === void 0 ? 20 : _ref2$limit,\n        where = _ref2.where;\n\n    var ref = _this.db.collection(collection);\n\n    if (startAt !== null) ref = ref.startAt(startAt);\n    if (limit !== null) ref = ref.limit(limit);\n\n    if (orderBy !== null) {\n      var field = orderBy.field,\n          op = orderBy.op;\n      ref = ref.orderBy(field, op);\n    }\n\n    if (where !== null) {\n      var _field = where.field,\n          _op = where.op,\n          value = where.value;\n      ref = ref.where(_field, _op, value);\n    }\n\n    return ref;\n  });\n\n  _defineProperty(this, \"getQuerySnapshotData\", /*#__PURE__*/function () {\n    var _ref3 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee(querySnapshot) {\n      var addUid,\n          res,\n          _args = arguments;\n      return _regeneratorRuntime.wrap(function _callee$(_context) {\n        while (1) {\n          switch (_context.prev = _context.next) {\n            case 0:\n              addUid = _args.length > 1 && _args[1] !== undefined ? _args[1] : false;\n              res = [];\n              querySnapshot.forEach(function (doc) {\n                if (doc.exists) {\n                  if (addUid) {\n                    res.push(_objectSpread(_objectSpread({}, doc.data()), {}, {\n                      id: doc.id\n                    }));\n                  } else {\n                    res.push(_objectSpread({}, doc.data()));\n                  }\n                }\n              });\n              console.log('snap', res);\n              return _context.abrupt(\"return\", res);\n\n            case 5:\n            case \"end\":\n              return _context.stop();\n          }\n        }\n      }, _callee);\n    }));\n\n    return function (_x) {\n      return _ref3.apply(this, arguments);\n    };\n  }());\n\n  _defineProperty(this, \"GetSnapShot\", /*#__PURE__*/function () {\n    var _ref4 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee3(collection) {\n      return _regeneratorRuntime.wrap(function _callee3$(_context3) {\n        while (1) {\n          switch (_context3.prev = _context3.next) {\n            case 0:\n              return _context3.abrupt(\"return\", new Promise( /*#__PURE__*/function () {\n                var _ref5 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee2(resolve) {\n                  return _regeneratorRuntime.wrap(function _callee2$(_context2) {\n                    while (1) {\n                      switch (_context2.prev = _context2.next) {\n                        case 0:\n                          firebase.firestore().collection(collection).onSnapshot(function (snapshot) {\n                            var data = snapshot.docs.map(function (doc) {\n                              return _objectSpread({\n                                id: doc.id\n                              }, doc.data());\n                            });\n                            console.log('snap', data);\n                            resolve(data);\n                          });\n\n                        case 1:\n                        case \"end\":\n                          return _context2.stop();\n                      }\n                    }\n                  }, _callee2);\n                }));\n\n                return function (_x3) {\n                  return _ref5.apply(this, arguments);\n                };\n              }()));\n\n            case 1:\n            case \"end\":\n              return _context3.stop();\n          }\n        }\n      }, _callee3);\n    }));\n\n    return function (_x2) {\n      return _ref4.apply(this, arguments);\n    };\n  }());\n\n  _defineProperty(this, \"getCollectionData\", function () {\n    var _ref6 = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {},\n        collection = _ref6.collection,\n        _ref6$orderBy = _ref6.orderBy,\n        orderBy = _ref6$orderBy === void 0 ? null : _ref6$orderBy,\n        _ref6$startAt = _ref6.startAt,\n        startAt = _ref6$startAt === void 0 ? null : _ref6$startAt,\n        _ref6$addUid = _ref6.addUid,\n        addUid = _ref6$addUid === void 0 ? true : _ref6$addUid,\n        _ref6$limit = _ref6.limit,\n        limit = _ref6$limit === void 0 ? null : _ref6$limit,\n        _ref6$where = _ref6.where,\n        where = _ref6$where === void 0 ? null : _ref6$where,\n        _ref6$cache = _ref6.cache,\n        cache = _ref6$cache === void 0 ? false : _ref6$cache;\n\n    if (isEmpty(collection)) return [];\n\n    if (cache && !isEmpty(getCookie(collection))) {\n      return getCookie(collection);\n    }\n\n    return new Promise( /*#__PURE__*/function () {\n      var _ref7 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee4(resolve, reject) {\n        var docRef, querySnapshot, res;\n        return _regeneratorRuntime.wrap(function _callee4$(_context4) {\n          while (1) {\n            switch (_context4.prev = _context4.next) {\n              case 0:\n                docRef = _this.query({\n                  collection: collection,\n                  orderBy: orderBy,\n                  startAt: startAt,\n                  limit: limit,\n                  where: where\n                });\n                _context4.prev = 1;\n                _context4.next = 4;\n                return docRef.get();\n\n              case 4:\n                querySnapshot = _context4.sent;\n                _context4.next = 7;\n                return _this.getQuerySnapshotData(querySnapshot, addUid);\n\n              case 7:\n                res = _context4.sent;\n                if (cache) setCookie(collection, res);\n                resolve(res);\n                _context4.next = 15;\n                break;\n\n              case 12:\n                _context4.prev = 12;\n                _context4.t0 = _context4[\"catch\"](1);\n                reject(_context4.t0);\n\n              case 15:\n              case \"end\":\n                return _context4.stop();\n            }\n          }\n        }, _callee4, null, [[1, 12]]);\n      }));\n\n      return function (_x4, _x5) {\n        return _ref7.apply(this, arguments);\n      };\n    }());\n  });\n\n  _defineProperty(this, \"saveData\", function (_ref8) {\n    var _ref8$collection = _ref8.collection,\n        collection = _ref8$collection === void 0 ? null : _ref8$collection,\n        _ref8$data = _ref8.data,\n        data = _ref8$data === void 0 ? {} : _ref8$data,\n        _ref8$id = _ref8.id,\n        id = _ref8$id === void 0 ? null : _ref8$id;\n    return new Promise( /*#__PURE__*/function () {\n      var _ref9 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee5(resolve, reject) {\n        var dbRef, docRef, doc, docId, docData;\n        return _regeneratorRuntime.wrap(function _callee5$(_context5) {\n          while (1) {\n            switch (_context5.prev = _context5.next) {\n              case 0:\n                if (!collection) reject(new Error(\"Set collection name\"));\n                _context5.prev = 1;\n                dbRef = _this.db.collection(collection);\n\n                if (!id) {\n                  _context5.next = 10;\n                  break;\n                }\n\n                dbRef.doc(id);\n                _context5.next = 7;\n                return dbRef.doc(id).set(data);\n\n              case 7:\n                docRef = _this.getRef({\n                  collection: collection,\n                  doc: id\n                });\n                _context5.next = 13;\n                break;\n\n              case 10:\n                _context5.next = 12;\n                return dbRef.add(data);\n\n              case 12:\n                docRef = _context5.sent;\n\n              case 13:\n                _context5.next = 15;\n                return docRef.get();\n\n              case 15:\n                doc = _context5.sent;\n                docId = doc.id;\n                docData = doc.data();\n                resolve(_objectSpread({\n                  id: docId,\n                  ref: docRef\n                }, docData));\n                _context5.next = 24;\n                break;\n\n              case 21:\n                _context5.prev = 21;\n                _context5.t0 = _context5[\"catch\"](1);\n                reject(_context5.t0);\n\n              case 24:\n              case \"end\":\n                return _context5.stop();\n            }\n          }\n        }, _callee5, null, [[1, 21]]);\n      }));\n\n      return function (_x6, _x7) {\n        return _ref9.apply(this, arguments);\n      };\n    }());\n  });\n\n  _defineProperty(this, \"deleteDocument\", function (_ref10) {\n    var _ref10$collection = _ref10.collection,\n        collection = _ref10$collection === void 0 ? null : _ref10$collection,\n        _ref10$id = _ref10.id,\n        id = _ref10$id === void 0 ? null : _ref10$id;\n    return new Promise( /*#__PURE__*/function () {\n      var _ref11 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee6(resolve, reject) {\n        var dbRef;\n        return _regeneratorRuntime.wrap(function _callee6$(_context6) {\n          while (1) {\n            switch (_context6.prev = _context6.next) {\n              case 0:\n                if (!collection) reject(new Error(\"Set collection name\"));\n                if (!id) reject(new Error(\"Set document id\"));\n                _context6.prev = 2;\n                dbRef = _this.db.collection(collection).doc(id);\n                _context6.next = 6;\n                return dbRef[\"delete\"]();\n\n              case 6:\n                resolve(true);\n                _context6.next = 12;\n                break;\n\n              case 9:\n                _context6.prev = 9;\n                _context6.t0 = _context6[\"catch\"](2);\n                reject(_context6.t0);\n\n              case 12:\n              case \"end\":\n                return _context6.stop();\n            }\n          }\n        }, _callee6, null, [[2, 9]]);\n      }));\n\n      return function (_x8, _x9) {\n        return _ref11.apply(this, arguments);\n      };\n    }());\n  });\n\n  _defineProperty(this, \"sanitizeUser\", function (user) {\n    return {\n      uid: get(user, \"uid\"),\n      email: get(user, \"email\") || null,\n      displayName: get(user, \"displayName\") || null,\n      photoURL: get(user, \"photoURL\") || null,\n      emailVerified: get(user, \"emailVerified\") || null,\n      phoneNumber: get(user, \"phoneNumber\") || null,\n      team: get(user, \"team\") || null\n    };\n  });\n\n  _defineProperty(this, \"getDocumentData\", /*#__PURE__*/_asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee7() {\n    var _ref13,\n        collection,\n        documentId,\n        docRef,\n        doc,\n        id,\n        data,\n        _args7 = arguments;\n\n    return _regeneratorRuntime.wrap(function _callee7$(_context7) {\n      while (1) {\n        switch (_context7.prev = _context7.next) {\n          case 0:\n            _ref13 = _args7.length > 0 && _args7[0] !== undefined ? _args7[0] : {}, collection = _ref13.collection, documentId = _ref13.documentId;\n\n            if (documentId) {\n              _context7.next = 3;\n              break;\n            }\n\n            throw new Error(\"documentId is mandatory\");\n\n          case 3:\n            docRef = _this.db.collection(collection).doc(documentId);\n            _context7.next = 6;\n            return docRef.get();\n\n          case 6:\n            doc = _context7.sent;\n            id = doc.id;\n            data = doc.data();\n            return _context7.abrupt(\"return\", _objectSpread({\n              id: id,\n              ref: docRef\n            }, data));\n\n          case 10:\n          case \"end\":\n            return _context7.stop();\n        }\n      }\n    }, _callee7);\n  })));\n\n  _defineProperty(this, \"getUser\", /*#__PURE__*/function () {\n    var _ref14 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee8(user) {\n      var doc;\n      return _regeneratorRuntime.wrap(function _callee8$(_context8) {\n        while (1) {\n          switch (_context8.prev = _context8.next) {\n            case 0:\n              _context8.next = 2;\n              return _this.db.collection(\"users\").doc(user.uid).get();\n\n            case 2:\n              doc = _context8.sent;\n              return _context8.abrupt(\"return\", doc.data());\n\n            case 4:\n            case \"end\":\n              return _context8.stop();\n          }\n        }\n      }, _callee8);\n    }));\n\n    return function (_x10) {\n      return _ref14.apply(this, arguments);\n    };\n  }());\n\n  _defineProperty(this, \"fillUserData\", /*#__PURE__*/function () {\n    var _ref15 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee9(user) {\n      var doc, data;\n      return _regeneratorRuntime.wrap(function _callee9$(_context9) {\n        while (1) {\n          switch (_context9.prev = _context9.next) {\n            case 0:\n              _context9.next = 2;\n              return _this.db.collection(\"users\").doc(user.uid).get();\n\n            case 2:\n              doc = _context9.sent;\n              data = doc.data();\n\n              if (!doc.exists) {\n                _context9.next = 6;\n                break;\n              }\n\n              return _context9.abrupt(\"return\", _objectSpread(_objectSpread({}, user), data));\n\n            case 6:\n              return _context9.abrupt(\"return\", user);\n\n            case 7:\n            case \"end\":\n              return _context9.stop();\n          }\n        }\n      }, _callee9);\n    }));\n\n    return function (_x11) {\n      return _ref15.apply(this, arguments);\n    };\n  }());\n\n  _defineProperty(this, \"doAuthWithGoogle\", function () {\n    var provider = new firebase.auth.GoogleAuthProvider();\n    return new Promise(function (resolve, reject) {\n      firebase.auth().signInWithPopup(provider).then( /*#__PURE__*/function () {\n        var _ref16 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee10(resp) {\n          var user, additionalUserInfo, sanitizeUser, userToSave, idToken;\n          return _regeneratorRuntime.wrap(function _callee10$(_context10) {\n            while (1) {\n              switch (_context10.prev = _context10.next) {\n                case 0:\n                  if (!resp) {\n                    _context10.next = 16;\n                    break;\n                  }\n\n                  user = resp.user;\n                  additionalUserInfo = resp.additionalUserInfo;\n\n                  if (!additionalUserInfo.isNewUser) {\n                    _context10.next = 9;\n                    break;\n                  }\n\n                  sanitizeUser = _this.sanitizeUser(user);\n                  userToSave = _objectSpread(_objectSpread({}, sanitizeUser), {}, {\n                    createdAt: new Date()\n                  });\n                  _context10.next = 8;\n                  return _this.saveData({\n                    collection: \"users\",\n                    data: userToSave,\n                    id: user.uid\n                  });\n\n                case 8:\n                  console.log(\"user saved in users collection\");\n\n                case 9:\n                  idToken = resp.credential.idToken;\n                  console.log({\n                    idToken: idToken\n                  });\n                  _context10.next = 13;\n                  return _this.fillUserData(_this.sanitizeUser(user));\n\n                case 13:\n                  user = _context10.sent;\n                  console.log({\n                    user: user\n                  });\n                  resolve({\n                    user: user,\n                    idToken: idToken\n                  });\n\n                case 16:\n                  reject(new Error(\"Sorry, something went wrong. Please try later\"));\n\n                case 17:\n                case \"end\":\n                  return _context10.stop();\n              }\n            }\n          }, _callee10);\n        }));\n\n        return function (_x12) {\n          return _ref16.apply(this, arguments);\n        };\n      }())[\"catch\"](function (error) {\n        var code = error.code;\n        var message = \"Sorry, something went wrong. Please try later\";\n\n        if (code) {\n          message = get(firebaseErrors, code);\n        }\n\n        reject(new Error(message));\n      });\n    });\n  });\n\n  _defineProperty(this, \"doAuthWithGithub\", function () {\n    var provider = new firebase.auth.GithubAuthProvider();\n    provider.addScope(\"read:user\");\n    return new Promise(function (resolve, reject) {\n      firebase.auth().signInWithPopup(provider).then( /*#__PURE__*/function () {\n        var _ref17 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee11(resp) {\n          var user, idToken, additionalUserInfo, sanitizeUser, userToSave;\n          return _regeneratorRuntime.wrap(function _callee11$(_context11) {\n            while (1) {\n              switch (_context11.prev = _context11.next) {\n                case 0:\n                  if (!resp) {\n                    _context11.next = 18;\n                    break;\n                  }\n\n                  user = resp.user;\n\n                  if (user.emailVerified) {\n                    _context11.next = 5;\n                    break;\n                  }\n\n                  _context11.next = 5;\n                  return user.sendEmailVerification();\n\n                case 5:\n                  idToken = resp.credential.idToken;\n                  additionalUserInfo = resp.additionalUserInfo;\n\n                  if (!additionalUserInfo.isNewUser) {\n                    _context11.next = 12;\n                    break;\n                  }\n\n                  sanitizeUser = _this.sanitizeUser(user);\n                  userToSave = _objectSpread(_objectSpread({}, sanitizeUser), {}, {\n                    createdAt: new Date()\n                  });\n                  _context11.next = 12;\n                  return _this.saveData({\n                    collection: \"users\",\n                    data: userToSave,\n                    id: user.uid\n                  });\n\n                case 12:\n                  _context11.next = 14;\n                  return _this.fillUserData(_this.sanitizeUser(user));\n\n                case 14:\n                  user = _context11.sent;\n                  resolve({\n                    user: user,\n                    idToken: idToken\n                  });\n                  _context11.next = 19;\n                  break;\n\n                case 18:\n                  reject(new Error(\"Sorry, something went wrong. Please try later\"));\n\n                case 19:\n                case \"end\":\n                  return _context11.stop();\n              }\n            }\n          }, _callee11);\n        }));\n\n        return function (_x13) {\n          return _ref17.apply(this, arguments);\n        };\n      }())[\"catch\"](function (error) {\n        var code = error.code;\n        var message = \"Sorry, something went wrong. Please try later\";\n\n        if (code) {\n          message = get(firebaseErrors, code);\n        }\n\n        reject(new Error(message));\n      });\n    });\n  });\n\n  _defineProperty(this, \"doSignOut\", function () {\n    _this.auth.signOut();\n  });\n\n  if (!firebase.apps.length) {\n    firebase.initializeApp(config);\n  }\n\n  if (!isServer && isProd) {\n    this.analytics = firebase.analytics();\n    this.analytics.logEvent(\"alive\");\n  }\n\n  this.auth = firebase.auth();\n  this.db = firebase.firestore();\n  auth = this.auth;\n  firestore = this.db;\n}\n/**\r\n * Return if user is auth\r\n */\n;\n\nexport { Firebase, auth, firestore };","map":{"version":3,"sources":["C:/Users/yosho/Documents/Next-Restaurant/delivery-rest/lib/firebase.js"],"names":["isServer","isProd","config","apiKey","authDomain","databaseURL","projectId","storageBucket","messagingSenderId","appId","auth","firestore","analytics","Firebase","currentUser","collection","doc","db","authUser","getRef","uid","orderBy","startAt","limit","where","ref","field","op","value","querySnapshot","addUid","res","forEach","exists","push","data","id","console","log","Promise","resolve","firebase","onSnapshot","snapshot","docs","map","cache","isEmpty","getCookie","reject","docRef","query","get","getQuerySnapshotData","setCookie","Error","dbRef","set","add","docId","docData","user","email","displayName","photoURL","emailVerified","phoneNumber","team","documentId","provider","GoogleAuthProvider","signInWithPopup","then","resp","additionalUserInfo","isNewUser","sanitizeUser","userToSave","createdAt","Date","saveData","idToken","credential","fillUserData","error","code","message","firebaseErrors","GithubAuthProvider","addScope","sendEmailVerification","signOut","apps","length","initializeApp","logEvent"],"mappings":"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","sourcesContent":["\r\n// Firebase services\r\nimport \"firebase/firestore\";\r\nimport \"firebase/auth\";\r\n\r\n\r\nconst isServer = typeof window === \"undefined\";\r\nconst isProd = process.env.NODE_ENV === \"production\";\r\n\r\nconst config = {\r\n  apiKey: \"AIzaSyBBjKdrfUqYxzv8AuFezBLttmiUj6evhz0\",\r\n  authDomain: \"testing-2b05e.firebaseapp.com\",\r\n  databaseURL: \"https://testing-2b05e.firebaseio.com\",\r\n  projectId: \"testing-2b05e\",\r\n  storageBucket: \"testing-2b05e.appspot.com\",\r\n  messagingSenderId: \"671346717916\",\r\n  appId: \"1:671346717916:web:273e09a3717613e7c3b019\",\r\n};\r\n\r\nlet auth = null;\r\nlet firestore = null;\r\nlet analytics = null;\r\n\r\nclass Firebase {\r\n  constructor() {\r\n    if (!firebase.apps.length) {\r\n      firebase.initializeApp(config);\r\n    }\r\n    if (!isServer && isProd) {\r\n      this.analytics = firebase.analytics();\r\n      this.analytics.logEvent(\"alive\");\r\n    }\r\n    this.auth = firebase.auth();\r\n    this.db = firebase.firestore();\r\n    auth = this.auth;\r\n    firestore = this.db;\r\n  \r\n  }\r\n\r\n  /**\r\n   * Return if user is auth\r\n   */\r\n  isAuthUser = () => {\r\n    return this.auth.currentUser !== null;\r\n  };\r\n\r\n  /**\r\n   * Return auth user\r\n   */\r\n  authUser = () => this.auth.currentUser;\r\n\r\n  /**\r\n   * Return ref for any collection\r\n   */\r\n  getRef = ({ collection, doc }) => this.db.collection(collection).doc(doc);\r\n\r\n  /**\r\n   * Return auth user ref\r\n   */\r\n  authRef = () => {\r\n    const authUser = this.authUser();\r\n    if (!authUser) {\r\n      return null;\r\n    }\r\n    return this.getRef({ collection: \"users\", doc: authUser.uid });\r\n  };\r\n\r\n  /**\r\n   * Universal Query to firebase collections\r\n   * @param collection [collection name]\r\n   * @param orderBy? [orderBy clausure, object { field, op }]\r\n   * @param startAt? [startAt] pagination startAt\r\n   * @param limit [limit of collection data]\r\n   * @param where [where clausure, object { field, op, value }]\r\n   */\r\n  query = ({\r\n    collection,\r\n    orderBy = null,\r\n    startAt = null,\r\n    limit = 20,\r\n    where,\r\n  } = {}) => {\r\n    let ref = this.db.collection(collection);\r\n    if (startAt !== null) ref = ref.startAt(startAt);\r\n    if (limit !== null) ref = ref.limit(limit);\r\n    if (orderBy !== null) {\r\n      const { field, op } = orderBy;\r\n      ref = ref.orderBy(field, op);\r\n    }\r\n    if (where !== null) {\r\n      const { field, op, value } = where;\r\n      ref = ref.where(field, op, value);\r\n    }\r\n    return ref;\r\n  };\r\n\r\n  /**\r\n   * Return snapshot data\r\n   * @param querySnapshot [Query Firebase snapshot data]\r\n   */\r\n  getQuerySnapshotData = async (querySnapshot, addUid = false) => {\r\n    const res = [];\r\n    querySnapshot.forEach((doc) => {\r\n      if (doc.exists) {\r\n        if (addUid) {\r\n          res.push({ ...doc.data(), id: doc.id });\r\n        } else {\r\n          res.push({ ...doc.data() });\r\n        }\r\n      }\r\n    }); console.log('snap',res);\r\n    return res;\r\n  };\r\n\r\n\r\n\r\n\r\n  GetSnapShot = async (collection) => {\r\n    return new Promise(async (resolve) => {\r\n      firebase\r\n        .firestore()\r\n        .collection(collection)\r\n        .onSnapshot((snapshot) => {\r\n          const data = snapshot.docs.map((doc) => ({\r\n            id: doc.id,\r\n            ...doc.data(),\r\n          }));\r\n          console.log('snap',data);\r\n          resolve(data);\r\n        });\r\n    });\r\n  };\r\n\r\n  /**\r\n   * Universal collection data\r\n   * @param collection [collection name]\r\n   * @param orderBy? [orderBy colection]\r\n   * @param orderByOp? [orderBy Op ex. 'desc', 'asc']\r\n   * @param startAt? [startAt] pagination startAt\r\n   * @param limit [limit of collection data]\r\n   * @param where [where clausure, object { field, op, value }]\r\n   */\r\n  getCollectionData = ({\r\n    collection,\r\n    orderBy = null,\r\n    startAt = null,\r\n    addUid = true,\r\n    limit = null,\r\n    where = null,\r\n    cache = false,\r\n  } = {}) => {\r\n    if (isEmpty(collection)) return [];\r\n    if (cache && !isEmpty(getCookie(collection))) {\r\n      return getCookie(collection);\r\n    }\r\n    return new Promise(async (resolve, reject) => {\r\n      const docRef = this.query({ collection, orderBy, startAt, limit, where });\r\n      try {\r\n        const querySnapshot = await docRef.get();\r\n        const res = await this.getQuerySnapshotData(querySnapshot, addUid);\r\n        if (cache) setCookie(collection, res);\r\n        resolve(res);\r\n      } catch (error) {\r\n        reject(error);\r\n      }\r\n    });\r\n  };\r\n\r\n  /**\r\n   * Generic: Save data into collection especified\r\n   * @param string collection\r\n   * @param object data\r\n   * @param string id\r\n   * @param bool merge\r\n   * @return Promise\r\n   */\r\n  saveData = ({ collection = null, data = {}, id = null }) => {\r\n    return new Promise(async (resolve, reject) => {\r\n      if (!collection) reject(new Error(\"Set collection name\"));\r\n      try {\r\n        const dbRef = this.db.collection(collection);\r\n        let docRef;\r\n        if (id) {\r\n          dbRef.doc(id);\r\n          await dbRef.doc(id).set(data);\r\n          docRef = this.getRef({ collection, doc: id });\r\n        } else {\r\n          docRef = await dbRef.add(data);\r\n        }\r\n        const doc = await docRef.get();\r\n        const { id: docId } = doc;\r\n        const docData = doc.data();\r\n        resolve({ id: docId, ref: docRef, ...docData });\r\n      } catch (error) {\r\n        reject(error);\r\n      }\r\n    });\r\n  };\r\n\r\n  /**\r\n   * Generic: Delete document into collection especified\r\n   * @param string collection\r\n   * @param string id\r\n   * @return Promise\r\n   */\r\n  deleteDocument = ({ collection = null, id = null }) => {\r\n    return new Promise(async (resolve, reject) => {\r\n      if (!collection) reject(new Error(\"Set collection name\"));\r\n      if (!id) reject(new Error(\"Set document id\"));\r\n\r\n      try {\r\n        const dbRef = this.db.collection(collection).doc(id);\r\n        await dbRef.delete();\r\n        resolve(true);\r\n      } catch (error) {\r\n        reject(error);\r\n      }\r\n    });\r\n  };\r\n\r\n  sanitizeUser = (user) => {\r\n    return {\r\n      uid: get(user, \"uid\"),\r\n      email: get(user, \"email\") || null,\r\n      displayName: get(user, \"displayName\") || null,\r\n      photoURL: get(user, \"photoURL\") || null,\r\n      emailVerified: get(user, \"emailVerified\") || null,\r\n      phoneNumber: get(user, \"phoneNumber\") || null,\r\n      team: get(user, \"team\") || null,\r\n    };\r\n  };\r\n\r\n  getDocumentData = async ({ collection, documentId } = {}) => {\r\n    if (!documentId) throw new Error(\"documentId is mandatory\");\r\n    const docRef = this.db.collection(collection).doc(documentId);\r\n    const doc = await docRef.get();\r\n    const { id } = doc;\r\n    const data = doc.data();\r\n    return { id, ref: docRef, ...data };\r\n  };\r\n\r\n  getUser = async (user) => {\r\n    const doc = await this.db.collection(\"users\").doc(user.uid).get();\r\n    return doc.data();\r\n  };\r\n\r\n  fillUserData = async (user) => {\r\n    const doc = await this.db.collection(\"users\").doc(user.uid).get();\r\n    const data = doc.data();\r\n    if (doc.exists) {\r\n      return { ...user, ...data };\r\n    }\r\n    return user;\r\n  };\r\n\r\n  // ** Auth with google **\r\n  doAuthWithGoogle = () => {\r\n    const provider = new firebase.auth.GoogleAuthProvider();\r\n    return new Promise((resolve, reject) => {\r\n      firebase\r\n        .auth()\r\n        .signInWithPopup(provider)\r\n        .then(async (resp) => {\r\n          if (resp) {\r\n            let { user } = resp;\r\n            const { additionalUserInfo } = resp;\r\n            if (additionalUserInfo.isNewUser) {\r\n              const sanitizeUser = this.sanitizeUser(user);\r\n              const userToSave = {\r\n                ...sanitizeUser,\r\n                createdAt: new Date(),\r\n              };\r\n              await this.saveData({\r\n                collection: \"users\",\r\n                data: userToSave,\r\n                id: user.uid,\r\n              });\r\n              console.log(\"user saved in users collection\");\r\n            }\r\n            const { idToken } = resp.credential;\r\n            console.log({ idToken });\r\n            user = await this.fillUserData(this.sanitizeUser(user));\r\n            console.log({ user });\r\n            resolve({ user, idToken });\r\n          }\r\n          reject(new Error(\"Sorry, something went wrong. Please try later\"));\r\n        })\r\n        .catch((error) => {\r\n          const { code } = error;\r\n          let message = \"Sorry, something went wrong. Please try later\";\r\n          if (code) {\r\n            message = get(firebaseErrors, code);\r\n          }\r\n          reject(new Error(message));\r\n        });\r\n    });\r\n  };\r\n\r\n  // ** Auth with github **\r\n  doAuthWithGithub = () => {\r\n    const provider = new firebase.auth.GithubAuthProvider();\r\n    provider.addScope(\"read:user\");\r\n    return new Promise((resolve, reject) => {\r\n      firebase\r\n        .auth()\r\n        .signInWithPopup(provider)\r\n        .then(async (resp) => {\r\n          if (resp) {\r\n            let { user } = resp;\r\n            if (!user.emailVerified) {\r\n              await user.sendEmailVerification();\r\n            }\r\n            const { idToken } = resp.credential;\r\n            const { additionalUserInfo } = resp;\r\n            if (additionalUserInfo.isNewUser) {\r\n              const sanitizeUser = this.sanitizeUser(user);\r\n              const userToSave = {\r\n                ...sanitizeUser,\r\n                createdAt: new Date(),\r\n              };\r\n              await this.saveData({\r\n                collection: \"users\",\r\n                data: userToSave,\r\n                id: user.uid,\r\n              });\r\n            }\r\n            user = await this.fillUserData(this.sanitizeUser(user));\r\n            resolve({ user, idToken });\r\n          } else {\r\n            reject(new Error(\"Sorry, something went wrong. Please try later\"));\r\n          }\r\n        })\r\n        .catch((error) => {\r\n          const { code } = error;\r\n          let message = \"Sorry, something went wrong. Please try later\";\r\n          if (code) {\r\n            message = get(firebaseErrors, code);\r\n          }\r\n          reject(new Error(message));\r\n        });\r\n    });\r\n  };\r\n\r\n  doSignOut = () => {\r\n    this.auth.signOut();\r\n  };\r\n\r\n  \r\n}\r\n\r\nexport { Firebase, auth, firestore };\r\n"]},"metadata":{},"sourceType":"module"}