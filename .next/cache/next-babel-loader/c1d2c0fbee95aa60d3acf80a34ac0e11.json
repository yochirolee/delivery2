{"ast":null,"code":"import _regeneratorRuntime from \"@babel/runtime/regenerator\";\nimport _asyncToGenerator from \"@babel/runtime/helpers/esm/asyncToGenerator\";\nimport _classCallCheck from \"@babel/runtime/helpers/esm/classCallCheck\";\nimport _defineProperty from \"@babel/runtime/helpers/esm/defineProperty\";\n\nfunction ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); if (enumerableOnly) symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; }); keys.push.apply(keys, symbols); } return keys; }\n\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; if (i % 2) { ownKeys(Object(source), true).forEach(function (key) { _defineProperty(target, key, source[key]); }); } else if (Object.getOwnPropertyDescriptors) { Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)); } else { ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } } return target; }\n\n// Firebase services\nimport \"firebase/firestore\";\nimport \"firebase/auth\";\nvar isServer = false;\nvar isProd = false;\nvar config = {\n  apiKey: \"AIzaSyBBjKdrfUqYxzv8AuFezBLttmiUj6evhz0\",\n  authDomain: \"testing-2b05e.firebaseapp.com\",\n  databaseURL: \"https://testing-2b05e.firebaseio.com\",\n  projectId: \"testing-2b05e\",\n  storageBucket: \"testing-2b05e.appspot.com\",\n  messagingSenderId: \"671346717916\",\n  appId: \"1:671346717916:web:273e09a3717613e7c3b019\"\n};\nvar auth = null;\nvar firestore = null;\nvar analytics = null;\n\nvar Firebase = function Firebase() {\n  var _this = this;\n\n  _classCallCheck(this, Firebase);\n\n  _defineProperty(this, \"getCollectionData\", function () {\n    var _ref = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {},\n        collection = _ref.collection,\n        _ref$orderBy = _ref.orderBy,\n        orderBy = _ref$orderBy === void 0 ? null : _ref$orderBy,\n        _ref$startAt = _ref.startAt,\n        startAt = _ref$startAt === void 0 ? null : _ref$startAt,\n        _ref$addUid = _ref.addUid,\n        addUid = _ref$addUid === void 0 ? true : _ref$addUid,\n        _ref$limit = _ref.limit,\n        limit = _ref$limit === void 0 ? null : _ref$limit,\n        _ref$where = _ref.where,\n        where = _ref$where === void 0 ? null : _ref$where,\n        _ref$cache = _ref.cache,\n        cache = _ref$cache === void 0 ? false : _ref$cache;\n\n    if (isEmpty(collection)) return [];\n\n    if (cache && !isEmpty(getCookie(collection))) {\n      return getCookie(collection);\n    }\n\n    return new Promise( /*#__PURE__*/function () {\n      var _ref2 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee(resolve, reject) {\n        var docRef, querySnapshot, res;\n        return _regeneratorRuntime.wrap(function _callee$(_context) {\n          while (1) {\n            switch (_context.prev = _context.next) {\n              case 0:\n                docRef = _this.query({\n                  collection: collection,\n                  orderBy: orderBy,\n                  startAt: startAt,\n                  limit: limit,\n                  where: where\n                });\n                _context.prev = 1;\n                _context.next = 4;\n                return docRef.get();\n\n              case 4:\n                querySnapshot = _context.sent;\n                _context.next = 7;\n                return _this.getQuerySnapshotData(querySnapshot, addUid);\n\n              case 7:\n                res = _context.sent;\n                if (cache) setCookie(collection, res);\n                resolve(res);\n                _context.next = 15;\n                break;\n\n              case 12:\n                _context.prev = 12;\n                _context.t0 = _context[\"catch\"](1);\n                reject(_context.t0);\n\n              case 15:\n              case \"end\":\n                return _context.stop();\n            }\n          }\n        }, _callee, null, [[1, 12]]);\n      }));\n\n      return function (_x, _x2) {\n        return _ref2.apply(this, arguments);\n      };\n    }());\n  });\n\n  _defineProperty(this, \"saveData\", function (_ref3) {\n    var _ref3$collection = _ref3.collection,\n        collection = _ref3$collection === void 0 ? null : _ref3$collection,\n        _ref3$data = _ref3.data,\n        data = _ref3$data === void 0 ? {} : _ref3$data,\n        _ref3$id = _ref3.id,\n        id = _ref3$id === void 0 ? null : _ref3$id;\n    return new Promise( /*#__PURE__*/function () {\n      var _ref4 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee2(resolve, reject) {\n        var dbRef, docRef, doc, docId, docData;\n        return _regeneratorRuntime.wrap(function _callee2$(_context2) {\n          while (1) {\n            switch (_context2.prev = _context2.next) {\n              case 0:\n                if (!collection) reject(new Error(\"Set collection name\"));\n                _context2.prev = 1;\n                dbRef = _this.db.collection(collection);\n\n                if (!id) {\n                  _context2.next = 10;\n                  break;\n                }\n\n                dbRef.doc(id);\n                _context2.next = 7;\n                return dbRef.doc(id).set(data);\n\n              case 7:\n                docRef = _this.getRef({\n                  collection: collection,\n                  doc: id\n                });\n                _context2.next = 13;\n                break;\n\n              case 10:\n                _context2.next = 12;\n                return dbRef.add(data);\n\n              case 12:\n                docRef = _context2.sent;\n\n              case 13:\n                _context2.next = 15;\n                return docRef.get();\n\n              case 15:\n                doc = _context2.sent;\n                docId = doc.id;\n                docData = doc.data();\n                resolve(_objectSpread({\n                  id: docId,\n                  ref: docRef\n                }, docData));\n                _context2.next = 24;\n                break;\n\n              case 21:\n                _context2.prev = 21;\n                _context2.t0 = _context2[\"catch\"](1);\n                reject(_context2.t0);\n\n              case 24:\n              case \"end\":\n                return _context2.stop();\n            }\n          }\n        }, _callee2, null, [[1, 21]]);\n      }));\n\n      return function (_x3, _x4) {\n        return _ref4.apply(this, arguments);\n      };\n    }());\n  });\n\n  _defineProperty(this, \"deleteDocument\", function (_ref5) {\n    var _ref5$collection = _ref5.collection,\n        collection = _ref5$collection === void 0 ? null : _ref5$collection,\n        _ref5$id = _ref5.id,\n        id = _ref5$id === void 0 ? null : _ref5$id;\n    return new Promise( /*#__PURE__*/function () {\n      var _ref6 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee3(resolve, reject) {\n        var dbRef;\n        return _regeneratorRuntime.wrap(function _callee3$(_context3) {\n          while (1) {\n            switch (_context3.prev = _context3.next) {\n              case 0:\n                if (!collection) reject(new Error(\"Set collection name\"));\n                if (!id) reject(new Error(\"Set document id\"));\n                _context3.prev = 2;\n                dbRef = _this.db.collection(collection).doc(id);\n                _context3.next = 6;\n                return dbRef[\"delete\"]();\n\n              case 6:\n                resolve(true);\n                _context3.next = 12;\n                break;\n\n              case 9:\n                _context3.prev = 9;\n                _context3.t0 = _context3[\"catch\"](2);\n                reject(_context3.t0);\n\n              case 12:\n              case \"end\":\n                return _context3.stop();\n            }\n          }\n        }, _callee3, null, [[2, 9]]);\n      }));\n\n      return function (_x5, _x6) {\n        return _ref6.apply(this, arguments);\n      };\n    }());\n  });\n\n  _defineProperty(this, \"sanitizeUser\", function (user) {\n    return {\n      uid: get(user, \"uid\"),\n      email: get(user, \"email\") || null,\n      displayName: get(user, \"displayName\") || null,\n      photoURL: get(user, \"photoURL\") || null,\n      emailVerified: get(user, \"emailVerified\") || null,\n      phoneNumber: get(user, \"phoneNumber\") || null,\n      team: get(user, \"team\") || null\n    };\n  });\n\n  _defineProperty(this, \"getDocumentData\", /*#__PURE__*/_asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee4() {\n    var _ref8,\n        collection,\n        documentId,\n        docRef,\n        doc,\n        id,\n        data,\n        _args4 = arguments;\n\n    return _regeneratorRuntime.wrap(function _callee4$(_context4) {\n      while (1) {\n        switch (_context4.prev = _context4.next) {\n          case 0:\n            _ref8 = _args4.length > 0 && _args4[0] !== undefined ? _args4[0] : {}, collection = _ref8.collection, documentId = _ref8.documentId;\n\n            if (documentId) {\n              _context4.next = 3;\n              break;\n            }\n\n            throw new Error(\"documentId is mandatory\");\n\n          case 3:\n            docRef = _this.db.collection(collection).doc(documentId);\n            _context4.next = 6;\n            return docRef.get();\n\n          case 6:\n            doc = _context4.sent;\n            id = doc.id;\n            data = doc.data();\n            return _context4.abrupt(\"return\", _objectSpread({\n              id: id,\n              ref: docRef\n            }, data));\n\n          case 10:\n          case \"end\":\n            return _context4.stop();\n        }\n      }\n    }, _callee4);\n  })));\n\n  _defineProperty(this, \"getUser\", /*#__PURE__*/function () {\n    var _ref9 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee5(user) {\n      var doc;\n      return _regeneratorRuntime.wrap(function _callee5$(_context5) {\n        while (1) {\n          switch (_context5.prev = _context5.next) {\n            case 0:\n              _context5.next = 2;\n              return _this.db.collection(\"users\").doc(user.uid).get();\n\n            case 2:\n              doc = _context5.sent;\n              return _context5.abrupt(\"return\", doc.data());\n\n            case 4:\n            case \"end\":\n              return _context5.stop();\n          }\n        }\n      }, _callee5);\n    }));\n\n    return function (_x7) {\n      return _ref9.apply(this, arguments);\n    };\n  }());\n\n  _defineProperty(this, \"fillUserData\", /*#__PURE__*/function () {\n    var _ref10 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee6(user) {\n      var doc, data;\n      return _regeneratorRuntime.wrap(function _callee6$(_context6) {\n        while (1) {\n          switch (_context6.prev = _context6.next) {\n            case 0:\n              _context6.next = 2;\n              return _this.db.collection(\"users\").doc(user.uid).get();\n\n            case 2:\n              doc = _context6.sent;\n              data = doc.data();\n\n              if (!doc.exists) {\n                _context6.next = 6;\n                break;\n              }\n\n              return _context6.abrupt(\"return\", _objectSpread(_objectSpread({}, user), data));\n\n            case 6:\n              return _context6.abrupt(\"return\", user);\n\n            case 7:\n            case \"end\":\n              return _context6.stop();\n          }\n        }\n      }, _callee6);\n    }));\n\n    return function (_x8) {\n      return _ref10.apply(this, arguments);\n    };\n  }());\n\n  _defineProperty(this, \"doAuthWithGoogle\", function () {\n    var provider = new firebase.auth.GoogleAuthProvider();\n    return new Promise(function (resolve, reject) {\n      firebase.auth().signInWithPopup(provider).then( /*#__PURE__*/function () {\n        var _ref11 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee7(resp) {\n          var user, additionalUserInfo, sanitizeUser, userToSave, idToken;\n          return _regeneratorRuntime.wrap(function _callee7$(_context7) {\n            while (1) {\n              switch (_context7.prev = _context7.next) {\n                case 0:\n                  if (!resp) {\n                    _context7.next = 16;\n                    break;\n                  }\n\n                  user = resp.user;\n                  additionalUserInfo = resp.additionalUserInfo;\n\n                  if (!additionalUserInfo.isNewUser) {\n                    _context7.next = 9;\n                    break;\n                  }\n\n                  sanitizeUser = _this.sanitizeUser(user);\n                  userToSave = _objectSpread(_objectSpread({}, sanitizeUser), {}, {\n                    createdAt: new Date()\n                  });\n                  _context7.next = 8;\n                  return _this.saveData({\n                    collection: \"users\",\n                    data: userToSave,\n                    id: user.uid\n                  });\n\n                case 8:\n                  console.log(\"user saved in users collection\");\n\n                case 9:\n                  idToken = resp.credential.idToken;\n                  console.log({\n                    idToken: idToken\n                  });\n                  _context7.next = 13;\n                  return _this.fillUserData(_this.sanitizeUser(user));\n\n                case 13:\n                  user = _context7.sent;\n                  console.log({\n                    user: user\n                  });\n                  resolve({\n                    user: user,\n                    idToken: idToken\n                  });\n\n                case 16:\n                  reject(new Error(\"Sorry, something went wrong. Please try later\"));\n\n                case 17:\n                case \"end\":\n                  return _context7.stop();\n              }\n            }\n          }, _callee7);\n        }));\n\n        return function (_x9) {\n          return _ref11.apply(this, arguments);\n        };\n      }())[\"catch\"](function (error) {\n        var code = error.code;\n        var message = \"Sorry, something went wrong. Please try later\";\n\n        if (code) {\n          message = get(firebaseErrors, code);\n        }\n\n        reject(new Error(message));\n      });\n    });\n  });\n\n  _defineProperty(this, \"doAuthWithGithub\", function () {\n    var provider = new firebase.auth.GithubAuthProvider();\n    provider.addScope(\"read:user\");\n    return new Promise(function (resolve, reject) {\n      firebase.auth().signInWithPopup(provider).then( /*#__PURE__*/function () {\n        var _ref12 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee8(resp) {\n          var user, idToken, additionalUserInfo, sanitizeUser, userToSave;\n          return _regeneratorRuntime.wrap(function _callee8$(_context8) {\n            while (1) {\n              switch (_context8.prev = _context8.next) {\n                case 0:\n                  if (!resp) {\n                    _context8.next = 18;\n                    break;\n                  }\n\n                  user = resp.user;\n\n                  if (user.emailVerified) {\n                    _context8.next = 5;\n                    break;\n                  }\n\n                  _context8.next = 5;\n                  return user.sendEmailVerification();\n\n                case 5:\n                  idToken = resp.credential.idToken;\n                  additionalUserInfo = resp.additionalUserInfo;\n\n                  if (!additionalUserInfo.isNewUser) {\n                    _context8.next = 12;\n                    break;\n                  }\n\n                  sanitizeUser = _this.sanitizeUser(user);\n                  userToSave = _objectSpread(_objectSpread({}, sanitizeUser), {}, {\n                    createdAt: new Date()\n                  });\n                  _context8.next = 12;\n                  return _this.saveData({\n                    collection: \"users\",\n                    data: userToSave,\n                    id: user.uid\n                  });\n\n                case 12:\n                  _context8.next = 14;\n                  return _this.fillUserData(_this.sanitizeUser(user));\n\n                case 14:\n                  user = _context8.sent;\n                  resolve({\n                    user: user,\n                    idToken: idToken\n                  });\n                  _context8.next = 19;\n                  break;\n\n                case 18:\n                  reject(new Error(\"Sorry, something went wrong. Please try later\"));\n\n                case 19:\n                case \"end\":\n                  return _context8.stop();\n              }\n            }\n          }, _callee8);\n        }));\n\n        return function (_x10) {\n          return _ref12.apply(this, arguments);\n        };\n      }())[\"catch\"](function (error) {\n        var code = error.code;\n        var message = \"Sorry, something went wrong. Please try later\";\n\n        if (code) {\n          message = get(firebaseErrors, code);\n        }\n\n        reject(new Error(message));\n      });\n    });\n  });\n\n  _defineProperty(this, \"doSignOut\", function () {\n    _this.auth.signOut();\n  });\n\n  if (!firebase.apps.length) {\n    firebase.initializeApp(config);\n  }\n\n  if (!isServer && isProd) {\n    this.analytics = firebase.analytics();\n    this.analytics.logEvent(\"alive\");\n  }\n\n  this.auth = firebase.auth();\n  this.db = firebase.firestore();\n  auth = this.auth;\n  firestore = this.db;\n};\n\nexport { Firebase, auth, firestore };","map":{"version":3,"sources":["C:/Users/yosho/Documents/Next-Restaurant/delivery-rest/lib/firebase.js"],"names":["isServer","isProd","config","apiKey","authDomain","databaseURL","projectId","storageBucket","messagingSenderId","appId","auth","firestore","analytics","Firebase","collection","orderBy","startAt","addUid","limit","where","cache","isEmpty","getCookie","Promise","resolve","reject","docRef","query","get","querySnapshot","getQuerySnapshotData","res","setCookie","data","id","Error","dbRef","db","doc","set","getRef","add","docId","docData","ref","user","uid","email","displayName","photoURL","emailVerified","phoneNumber","team","documentId","exists","provider","firebase","GoogleAuthProvider","signInWithPopup","then","resp","additionalUserInfo","isNewUser","sanitizeUser","userToSave","createdAt","Date","saveData","console","log","idToken","credential","fillUserData","error","code","message","firebaseErrors","GithubAuthProvider","addScope","sendEmailVerification","signOut","apps","length","initializeApp","logEvent"],"mappings":"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","sourcesContent":["\r\n// Firebase services\r\nimport \"firebase/firestore\";\r\nimport \"firebase/auth\";\r\n\r\n\r\nconst isServer = typeof window === \"undefined\";\r\nconst isProd = process.env.NODE_ENV === \"production\";\r\n\r\nconst config = {\r\n  apiKey: \"AIzaSyBBjKdrfUqYxzv8AuFezBLttmiUj6evhz0\",\r\n  authDomain: \"testing-2b05e.firebaseapp.com\",\r\n  databaseURL: \"https://testing-2b05e.firebaseio.com\",\r\n  projectId: \"testing-2b05e\",\r\n  storageBucket: \"testing-2b05e.appspot.com\",\r\n  messagingSenderId: \"671346717916\",\r\n  appId: \"1:671346717916:web:273e09a3717613e7c3b019\",\r\n};\r\n\r\nlet auth = null;\r\nlet firestore = null;\r\nlet analytics = null;\r\n\r\nclass Firebase {\r\n  constructor() {\r\n    if (!firebase.apps.length) {\r\n      firebase.initializeApp(config);\r\n    }\r\n    if (!isServer && isProd) {\r\n      this.analytics = firebase.analytics();\r\n      this.analytics.logEvent(\"alive\");\r\n    }\r\n    this.auth = firebase.auth();\r\n    this.db = firebase.firestore();\r\n    auth = this.auth;\r\n    firestore = this.db;\r\n  \r\n  }\r\n\r\n \r\n  getCollectionData = ({\r\n    collection,\r\n    orderBy = null,\r\n    startAt = null,\r\n    addUid = true,\r\n    limit = null,\r\n    where = null,\r\n    cache = false,\r\n  } = {}) => {\r\n    if (isEmpty(collection)) return [];\r\n    if (cache && !isEmpty(getCookie(collection))) {\r\n      return getCookie(collection);\r\n    }\r\n    return new Promise(async (resolve, reject) => {\r\n      const docRef = this.query({ collection, orderBy, startAt, limit, where });\r\n      try {\r\n        const querySnapshot = await docRef.get();\r\n        const res = await this.getQuerySnapshotData(querySnapshot, addUid);\r\n        if (cache) setCookie(collection, res);\r\n        resolve(res);\r\n      } catch (error) {\r\n        reject(error);\r\n      }\r\n    });\r\n  };\r\n\r\n  /**\r\n   * Generic: Save data into collection especified\r\n   * @param string collection\r\n   * @param object data\r\n   * @param string id\r\n   * @param bool merge\r\n   * @return Promise\r\n   */\r\n  saveData = ({ collection = null, data = {}, id = null }) => {\r\n    return new Promise(async (resolve, reject) => {\r\n      if (!collection) reject(new Error(\"Set collection name\"));\r\n      try {\r\n        const dbRef = this.db.collection(collection);\r\n        let docRef;\r\n        if (id) {\r\n          dbRef.doc(id);\r\n          await dbRef.doc(id).set(data);\r\n          docRef = this.getRef({ collection, doc: id });\r\n        } else {\r\n          docRef = await dbRef.add(data);\r\n        }\r\n        const doc = await docRef.get();\r\n        const { id: docId } = doc;\r\n        const docData = doc.data();\r\n        resolve({ id: docId, ref: docRef, ...docData });\r\n      } catch (error) {\r\n        reject(error);\r\n      }\r\n    });\r\n  };\r\n\r\n  /**\r\n   * Generic: Delete document into collection especified\r\n   * @param string collection\r\n   * @param string id\r\n   * @return Promise\r\n   */\r\n  deleteDocument = ({ collection = null, id = null }) => {\r\n    return new Promise(async (resolve, reject) => {\r\n      if (!collection) reject(new Error(\"Set collection name\"));\r\n      if (!id) reject(new Error(\"Set document id\"));\r\n\r\n      try {\r\n        const dbRef = this.db.collection(collection).doc(id);\r\n        await dbRef.delete();\r\n        resolve(true);\r\n      } catch (error) {\r\n        reject(error);\r\n      }\r\n    });\r\n  };\r\n\r\n  sanitizeUser = (user) => {\r\n    return {\r\n      uid: get(user, \"uid\"),\r\n      email: get(user, \"email\") || null,\r\n      displayName: get(user, \"displayName\") || null,\r\n      photoURL: get(user, \"photoURL\") || null,\r\n      emailVerified: get(user, \"emailVerified\") || null,\r\n      phoneNumber: get(user, \"phoneNumber\") || null,\r\n      team: get(user, \"team\") || null,\r\n    };\r\n  };\r\n\r\n  getDocumentData = async ({ collection, documentId } = {}) => {\r\n    if (!documentId) throw new Error(\"documentId is mandatory\");\r\n    const docRef = this.db.collection(collection).doc(documentId);\r\n    const doc = await docRef.get();\r\n    const { id } = doc;\r\n    const data = doc.data();\r\n    return { id, ref: docRef, ...data };\r\n  };\r\n\r\n  getUser = async (user) => {\r\n    const doc = await this.db.collection(\"users\").doc(user.uid).get();\r\n    return doc.data();\r\n  };\r\n\r\n  fillUserData = async (user) => {\r\n    const doc = await this.db.collection(\"users\").doc(user.uid).get();\r\n    const data = doc.data();\r\n    if (doc.exists) {\r\n      return { ...user, ...data };\r\n    }\r\n    return user;\r\n  };\r\n\r\n  // ** Auth with google **\r\n  doAuthWithGoogle = () => {\r\n    const provider = new firebase.auth.GoogleAuthProvider();\r\n    return new Promise((resolve, reject) => {\r\n      firebase\r\n        .auth()\r\n        .signInWithPopup(provider)\r\n        .then(async (resp) => {\r\n          if (resp) {\r\n            let { user } = resp;\r\n            const { additionalUserInfo } = resp;\r\n            if (additionalUserInfo.isNewUser) {\r\n              const sanitizeUser = this.sanitizeUser(user);\r\n              const userToSave = {\r\n                ...sanitizeUser,\r\n                createdAt: new Date(),\r\n              };\r\n              await this.saveData({\r\n                collection: \"users\",\r\n                data: userToSave,\r\n                id: user.uid,\r\n              });\r\n              console.log(\"user saved in users collection\");\r\n            }\r\n            const { idToken } = resp.credential;\r\n            console.log({ idToken });\r\n            user = await this.fillUserData(this.sanitizeUser(user));\r\n            console.log({ user });\r\n            resolve({ user, idToken });\r\n          }\r\n          reject(new Error(\"Sorry, something went wrong. Please try later\"));\r\n        })\r\n        .catch((error) => {\r\n          const { code } = error;\r\n          let message = \"Sorry, something went wrong. Please try later\";\r\n          if (code) {\r\n            message = get(firebaseErrors, code);\r\n          }\r\n          reject(new Error(message));\r\n        });\r\n    });\r\n  };\r\n\r\n  // ** Auth with github **\r\n  doAuthWithGithub = () => {\r\n    const provider = new firebase.auth.GithubAuthProvider();\r\n    provider.addScope(\"read:user\");\r\n    return new Promise((resolve, reject) => {\r\n      firebase\r\n        .auth()\r\n        .signInWithPopup(provider)\r\n        .then(async (resp) => {\r\n          if (resp) {\r\n            let { user } = resp;\r\n            if (!user.emailVerified) {\r\n              await user.sendEmailVerification();\r\n            }\r\n            const { idToken } = resp.credential;\r\n            const { additionalUserInfo } = resp;\r\n            if (additionalUserInfo.isNewUser) {\r\n              const sanitizeUser = this.sanitizeUser(user);\r\n              const userToSave = {\r\n                ...sanitizeUser,\r\n                createdAt: new Date(),\r\n              };\r\n              await this.saveData({\r\n                collection: \"users\",\r\n                data: userToSave,\r\n                id: user.uid,\r\n              });\r\n            }\r\n            user = await this.fillUserData(this.sanitizeUser(user));\r\n            resolve({ user, idToken });\r\n          } else {\r\n            reject(new Error(\"Sorry, something went wrong. Please try later\"));\r\n          }\r\n        })\r\n        .catch((error) => {\r\n          const { code } = error;\r\n          let message = \"Sorry, something went wrong. Please try later\";\r\n          if (code) {\r\n            message = get(firebaseErrors, code);\r\n          }\r\n          reject(new Error(message));\r\n        });\r\n    });\r\n  };\r\n\r\n  doSignOut = () => {\r\n    this.auth.signOut();\r\n  };\r\n\r\n  \r\n}\r\n\r\nexport { Firebase, auth, firestore };\r\n"]},"metadata":{},"sourceType":"module"}